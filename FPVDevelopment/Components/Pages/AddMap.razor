@page "/AddMap"
@using FPVDevelopment.Components.Services
@using FPVDevelopment.Components.Data.Models
@using static FPVDevelopment.Components.Globals.Enums
@inject MapService MapService;
@inject ISnackbar Snackbar
@rendermode InteractiveServer

<EditForm FormName="AddMapForm" Model="@_map" OnSubmit="@HandleSubmit">
    <MudGrid Edge="Edge.Start" Class="mr-16">
        <MudItem xs="12" sm="7">
            <MudCard>
                <MudCardHeader>
                    <MudText Typo="Typo.h6">Add a new map to the database.</MudText>
                </MudCardHeader>
                <MudCardContent Class="p-2 pt-1">
                    <MudStack Spacing="4">
                        <MudTextField Label="Map Name" HelperText="Max. 50 characters"
                                      @bind-Value="@_map.Name"></MudTextField>
                        <MudSelect T="MapDifficulty" @bind-Value="@_map.Difficulty" Label="Select a Difficulty">
                            @foreach (MapDifficulty difficulty in Enum.GetValues(typeof(MapDifficulty)))
                            {
                                <MudSelectItem Value="@difficulty">@difficulty</MudSelectItem>
                            }
                        </MudSelect>
                    </MudStack>
                </MudCardContent>
                <MudCardActions>
                    <MudButton
                        ButtonType="ButtonType.Submit"
                        Variant="Variant.Filled"
                        Color="Color.Primary"
                        disabled="@IsSubmitDisabled">
                        Add Map
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>
    </MudGrid>
</EditForm>

@code {
    private readonly Map _map = new Map();

    private bool IsSubmitDisabled =>
        string.IsNullOrWhiteSpace(_map.Name);

    private async Task HandleSubmit(EditContext editContext)
    {
        var newMap = new Map
        {
            Name = _map.Name,
            Difficulty = _map.Difficulty
        };
        
        var flag = await MapService.AddMap(newMap);
        if (flag)
            Snackbar.Add("Map Added!", Severity.Success);
        else
            Snackbar.Add("Map Failed To Add", Severity.Error);
    }
}