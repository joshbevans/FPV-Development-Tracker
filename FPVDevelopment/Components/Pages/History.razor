@page "/History"
@using FPVDevelopment.Components.Data.Classes
@using FPVDevelopment.Components.Data.Models
@inject CurrentUser CurrentUser
@inject CompletedRunService CompletedRunService
@inject DroneService DroneService
@inject MapService MapService
@rendermode InteractiveServer

<PageTitle>History</PageTitle>
<br />
<br />

<MudDataGrid Items="@_completedRunList">
    <Columns>
        <PropertyColumn Property="x => x.Map.Name" Title="Map Name"/>
        <PropertyColumn Property="x => x.Drone.Name" Title="Drone Name"/>
        <PropertyColumn Property="x => x.Drone.Size" Title="Drone Size"/>
    </Columns>
</MudDataGrid>


@code{
    private IList<Map> _mapList = [];
    private IList<Drone> _droneList = [];
    private IList<CompletedRun> _completedRunList = [];

    protected override async Task OnInitializedAsync()
    {
        _mapList = await  MapService.GetMaps();
        _droneList = await DroneService.GetDrones(CurrentUser.User);
        _completedRunList = await CompletedRunService.GetCompletedRuns(CurrentUser.User);
        CurrentUser.CurrentUserChangedEvent += OnCurrentUserChanged;
    }

    private void OnCurrentUserChanged(object? sender, EventArgs e)
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        CurrentUser.CurrentUserChangedEvent -= OnCurrentUserChanged;
    }
}